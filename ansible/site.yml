---
- name: DÃ©ploiement complet plateforme Wikijs SaaS
  hosts: wikijs_servers
  become: true

  # ðŸ”¹ On charge les variables globales et les instances fixes
  vars_files:
    - group_vars/all.yml   # Contient wikis_docker (ia/devops/cyber) + base_domain + kc_clients

  # ðŸ”¹ Ã‰tape 1 : Installation et configuration de la plateforme commune
  roles:
    - role: common       # Mise Ã  jour systÃ¨me, firewall, utilisateurs
    - role: docker       # Installation de Docker + Compose
    - role: traefik      # Reverse proxy + certificats Let's Encrypt
    - role: postgres     # CrÃ©ation des bases RDS + utilisateurs
    - role: keycloak     # Authentification SSO
    - role: wiki-essaie  # RÃ´le de gestion des instances Wiki.js
