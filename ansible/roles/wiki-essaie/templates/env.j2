############################################
# Wiki.js Instance: {{ item.name }}
############################################

# =====================
# Base de données (PostgreSQL Docker local)
# =====================
DB_TYPE=postgres
DB_HOST=db-{{ subdomain | default(item.name) }}
DB_PORT=5432
DB_USER={{ pg_user | default(item.pg_user) }}
DB_PASS={{ pg_pass | default(item.pg_pass) }}
DB_NAME={{ pg_db | default("wiki_" ~ item.name) }}
NETWORK=wikinet-{{ subdomain | default(item.name) }}
DB_SSL=false   # Pas besoin de SSL en réseau interne Docker


# =====================
# Authentification OIDC (Keycloak)
# =====================
OIDC_ENABLED=true
OIDC_CLIENT_ID=wiki-{{ subdomain | default(item.name) }}
OIDC_CLIENT_SECRET={{ kc_clients[item.name] }}
OIDC_CLIENT_SECRET={{ oidc_client_secret | default(kc_clients[item.name] | default("changeme")) }}
OIDC_SCOPE=openid profile email
OIDC_AUTO_CREATE_USERS=true
OIDC_GROUPS_CLAIM=groups

# =====================
# Stockage (Cloudflare R2)
# =====================
STORAGE_TYPE=s3
AWS_ACCESS_KEY_ID={{ s3_access_key }}
AWS_SECRET_ACCESS_KEY={{ s3_secret_key }}
AWS_ENDPOINT=https://wikijs-uploads.d5750627b9b12170d48dcdf9a55fb164.r2.cloudflarestorage.com
AWS_REGION=auto
S3_BUCKET=wikijs-uploads
S3_FORCE_PATH_STYLE=true

# =====================
# Application
# =====================
PORT=3000
BASE_URL=https://{{ item.name }}.{{ base_domain }}
ADMIN_EMAIL={{ item.admin_email }}
ADMIN_PASSWORD={{ item.admin_password }}
LOG_LEVEL=info
LOG_PRETTY=true
LOG_FILE_PATH=/logs/wikijs.log   # /logs car tu montes ./logs/wiki-*/:/logs
LOG_FILE_MAX_SIZE=10485760
LOG_FILE_MAX_FILES=10
TRUST_PROXY=true                 # Activer si derrière un proxy (ex: Traefik/Cloudflare)

# =====================
# Domaine
# ===================== 
DOMAIN={{ base_domain }}

# =====================
#  Hack temporaire pour certificats Let’s Encrypt STAGING a supprimer en prod       
# =====================
NODE_TLS_REJECT_UNAUTHORIZED=0
